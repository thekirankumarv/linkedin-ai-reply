import {
  download,
  tsconfigPaths,
  globals,
  extensionApiMock,
  resolveAppConfig
} from "../core/builders/vite/plugins/index.mjs";
import { vitePlugin as unimportPlugin } from "../builtin-modules/unimport.mjs";
import { createUnimport } from "unimport";
import { registerWxt, wxt } from "../core/wxt.mjs";
export async function WxtVitest(inlineConfig) {
  await registerWxt("serve", inlineConfig ?? {});
  const plugins = [
    globals(wxt.config),
    download(wxt.config),
    tsconfigPaths(wxt.config),
    resolveAppConfig(wxt.config),
    extensionApiMock(wxt.config)
  ];
  if (wxt.config.imports !== false) {
    const unimport = createUnimport(wxt.config.imports);
    await unimport.init();
    plugins.push(unimportPlugin(unimport));
  }
  return plugins;
}
